{% extends "base.html" %}
{% block content %}
<h2>Your Invoice History</h2>

{% if invoices %}
  <!-- Table for desktop (md and up) -->
  <div class="table-responsive d-none d-md-block">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Invoice #</th>
          <th>Client</th>
          <th>Description</th>
          <th>Email</th>
          <th>Total</th>
          <th>Status</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for invoice in invoices %}
        <tr style="cursor:pointer;" onclick="window.location='{{ url_for('invoice.view_invoice', invoice_id=invoice.id) }}'">
          <td>{{ invoice.id }}</td>
          <td>{{ invoice.invoice_data.client_name }}</td>
          <td>{{ invoice.invoice_data.description }}</td>
          <td>{{ invoice.invoice_data.client_email }}</td>
          <td>${{ "%.2f"|format(invoice.invoice_data.total) }}</td>
          <td><span class="badge {% if invoice.status == 'Paid' %}bg-success{% else %}bg-warning text-dark{% endif %}">{{ invoice.status }}</span></td>
          <td>{{ invoice.created_at.strftime('%d %b %Y') }}</td>
          <td>
            <a href="{{ url_for('invoice.view_invoice', invoice_id=invoice.id) }}" class="btn btn-outline-primary btn-sm">View</a>
            {% if invoice.status != 'Paid' %}
            <form method="post" action="{{ url_for('invoice.mark_paid', invoice_id=invoice.id) }}" style="display:inline;" onclick="event.stopPropagation();">
              <button type="submit" class="btn btn-success btn-sm ms-2">Mark as Paid</button>
            </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Cards for mobile (sm and below) -->
  <div class="d-block d-md-none">
    {% for invoice in invoices %}
      <div class="card mb-3">
        <div class="card-body">
          <div><strong>Invoice #:</strong> {{ invoice.id }}</div>
          <div><strong>Client:</strong> {{ invoice.invoice_data.client_name }}</div>
          <div><strong>Description:</strong> {{ invoice.invoice_data.description }}</div>
          <div><strong>Email:</strong> {{ invoice.invoice_data.client_email }}</div>
          <div><strong>Total:</strong> ${{ "%.2f"|format(invoice.invoice_data.total) }}</div>
          <div><strong>Status:</strong> <span class="badge {% if invoice.status == 'Paid' %}bg-success{% else %}bg-warning text-dark{% endif %}">{{ invoice.status }}</span></div>
          <div><strong>Created:</strong> {{ invoice.created_at.strftime('%d %b %Y') }}</div>
          <div class="mt-2">
            <a href="{{ url_for('invoice.view_invoice', invoice_id=invoice.id) }}" class="btn btn-outline-primary btn-sm">View</a>
            {% if invoice.status != 'Paid' %}
            <form method="post" action="{{ url_for('invoice.mark_paid', invoice_id=invoice.id) }}" style="display:inline;">
              <button type="submit" class="btn btn-success btn-sm ms-2">Mark as Paid</button>
            </form>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="text-center py-5">
    <div class="mb-4">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="#6c757d" stroke-width="2" fill="none"/>
        <path d="M14 2v6h6" stroke="#6c757d" stroke-width="2" fill="none"/>
        <path d="M16 13H8" stroke="#6c757d" stroke-width="2" fill="none"/>
        <path d="M16 17H8" stroke="#6c757d" stroke-width="2" fill="none"/>
        <path d="M10 9H8" stroke="#6c757d" stroke-width="2" fill="none"/>
      </svg>
    </div>
    <h4 class="text-muted mb-3">No Invoices Yet</h4>
    <p class="text-muted mb-4">You haven't created any invoices after buying premium. Start creating your first invoice to see it here!</p>
    <a href="{{ url_for('main.form') }}" class="btn btn-primary">
      <i class="fas fa-plus me-2"></i>Create Your First Invoice
    </a>
  </div>
{% endif %}
{% endblock %}
